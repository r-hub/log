<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>More admin tasks and dealing with Azure | The r-hub log</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/very-simple.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><!-- include the sidebar--><!-- include ./includes/sidebar.jade--><!-- use checkbox hack for toggle nav-bar on small screens--><input id="menu" type="checkbox"><!-- Navigation Links--><nav id="nav"><div class="container"><a href="/" class="sidebar-nav-item active">Home</a><a href="/archives" class="sidebar-nav-item">Archives</a></div></nav><!-- gallery that comes before the header--><div class="wrapper"><div class="container post-header"><h1>More admin tasks and dealing with Azure</h1></div></div><div class="wrapper"><div class="container meta"><div class="post-time">2016-09-20</div></div></div><article><div class="container post"><h2 id="Sensu-plugins-on-clients"><a href="#Sensu-plugins-on-clients" class="headerlink" title="Sensu plugins on clients"></a>Sensu plugins on clients</h2><p>OK, for the Sensu addition yesterday it turns out that two Sensu<br>plugins are also needed on clients:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sensu-install -p cpu-checks</div><div class="line">sensu-install -p disk-checks</div></pre></td></tr></table></figure>
<p>and then the new Sensu client is all green.</p>
<h2 id="Getting-rid-of-a-Sensu-check"><a href="#Getting-rid-of-a-Sensu-check" class="headerlink" title="Getting rid of a Sensu check"></a>Getting rid of a Sensu check</h2><p>This is surprisingly difficult. Yesterday I switched <code>cranlogs.r-pkg.org</code> to HTTPS, after getting a new certificate for it. It seems to work fine now, I don’t know what was the problem last time (<a href="https://github.com/metacran/cranlogs.app/issues/22" target="_blank" rel="external">https://github.com/metacran/cranlogs.app/issues/22</a>), but it works fine today.</p>
<p>I also updated the Sensu checks for <code>cranlogs</code>, to check HTTPS and also the HTTP -&gt; HTTPS redirect. It seems that to get rid of the old check, one has to restart the Sensu server and the client as well, both running on <code>monitor.r-hub.io</code> in this case.</p>
<p>Also, one needs to put the port number into the check. Even if the nginx redirect header does not have it: <code>https://cranlogs.r-pkg.org:443/downloads/daily/last-week/igraph</code></p>
<h2 id="Azure-disk-attach-detach"><a href="#Azure-disk-attach-detach" class="headerlink" title="Azure disk attach/detach"></a>Azure disk attach/detach</h2><p>This seems to a straightforwars enough operation, but it is not. Make sure that you close the browser tab, and open a new one to Azure, after each detach/attach operation, because the UI does not refresh the state of the disk. It is actually the same for the state of the virtual machine, you click on Stop, it stops (after some time), but the state is never updated, until a new browser UI window is used.</p>
<p>I wonder who thought this was a good idea. It only took me ~4 hours to solve this, thank you.</p>
<h2 id="Fedora-update"><a href="#Fedora-update" class="headerlink" title="Fedora update"></a>Fedora update</h2><p>Finally I fixed the Docker builds in <code>cran.r-hub.io</code>, and built new Fedora images. (<a href="https://github.com/r-hub/rhub-linux-builders/pull/12#issuecomment-247629893" target="_blank" rel="external">https://github.com/r-hub/rhub-linux-builders/pull/12#issuecomment-247629893</a>)</p>
<p>In the process of brushing up Jenkins, I made sure that I get emails about failures, both from <code>cran.r-hub.io</code> and <code>jenkins.r-pkg.org</code>. For this one needs to install <code>postfix</code>, and on <code>jenkins.r-pkg.org</code>, one also needs to allow the Docker subnets in the <code>main.mf</code> <code>postfix</code> config file, because there Jenkins runs in a container.</p>
<p>The only glitch is that the clang image does not build, because I would need another external clang repository for that. :(</p>
<h2 id="Dokku-update-on-metacran"><a href="#Dokku-update-on-metacran" class="headerlink" title="Dokku update on metacran"></a>Dokku update on metacran</h2><p>I updated Dokku to the latest stable version (0.7.1) on <code>r-pkg.org</code>. This affects <code>cranlogs.r-pkg.org</code>, <code>rversions.r-pkg.org</code>, <code>crandeps.r-pkg.org</code> as well. The new version uses the new plugins for Redis and PostgreSQL as well.</p>
</div><!-- comment system--><div class="container"><hr></div></article><footer id="footer"><div class="container"><div class="bar"><div class="social"><a href="/atom.xml" target="_blank"><i class="fa fa-rss"></i></a></div><div class="footer">© 2016 <a href="/" rel="nofollow">The r-hub log</a>. Powered by <a rel="nofollow" target="_blank" href="https://hexo.io">Hexo</a>. Theme <a target="_blank" href="https://github.com/lotabout/very-simple">very-simple</a>.</div></div></div></footer><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
    $(".fancybox").fancybox();
});
</script></body></html>